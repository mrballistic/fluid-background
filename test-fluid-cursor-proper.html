<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluidCursor Component - Proper Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        .test-content {
            position: relative;
            z-index: 100;
            color: white;
            padding: 20px;
            pointer-events: auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            margin: 20px;
            max-width: 400px;
        }
        
        h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        
        p {
            margin: 5px 0;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }
        
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        .success {
            color: #51cf66;
            background: rgba(81, 207, 102, 0.1);
        }
        
        .warning {
            color: #ffd43b;
            background: rgba(255, 212, 59, 0.1);
        }

        .controls {
            margin-top: 15px;
        }

        button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="test-content">
        <h1>FluidCursor Test</h1>
        <p><strong>Instructions:</strong></p>
        <p>‚Ä¢ Move your mouse to create fluid trails</p>
        <p>‚Ä¢ Click to create splashes</p>
        <p>‚Ä¢ You should see colorful fluid dynamics</p>
        
        <div id="status" class="status">
            Initializing FluidCursor component...
        </div>

        <div class="controls">
            <button onclick="testMouseMovement()">Test Mouse Movement</button>
            <button onclick="testClick()">Test Click Splash</button>
            <button onclick="toggleComponent()">Toggle Component</button>
        </div>
    </div>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script type="module">
        let componentActive = false;
        let fluidCursorRoot = null;

        // Import the actual FluidCursor component
        import('./dist/index.esm.js').then(({ FluidCursor }) => {
            const { createElement, useState, useEffect } = React;
            const { createRoot } = ReactDOM;

            function TestApp() {
                const [isActive, setIsActive] = useState(true);
                const [mousePos, setMousePos] = useState({ x: 0, y: 0 });

                useEffect(() => {
                    document.getElementById('status').innerHTML = 
                        '‚úÖ FluidCursor component loaded and rendered!<br>' +
                        'Move your mouse to see fluid simulation.<br>' +
                        'Click anywhere to create splashes.';
                    document.getElementById('status').className = 'status success';
                    componentActive = true;

                    // Track mouse movement for debugging
                    const handleMouseMove = (e) => {
                        setMousePos({ x: e.clientX, y: e.clientY });
                    };

                    window.addEventListener('mousemove', handleMouseMove);
                    return () => window.removeEventListener('mousemove', handleMouseMove);
                }, []);

                return createElement('div', null, 
                    isActive && createElement(FluidCursor, {
                        SIM_RESOLUTION: 128,
                        DYE_RESOLUTION: 1024,
                        DENSITY_DISSIPATION: 1.2,
                        VELOCITY_DISSIPATION: 0.2,
                        PRESSURE: 0.8,
                        PRESSURE_ITERATIONS: 20,
                        CURL: 30,
                        SPLAT_RADIUS: 0.25,
                        SPLAT_FORCE: 6000,
                        SHADING: true,
                        COLOR_UPDATE_SPEED: 10,
                        TRANSPARENT: true
                    })
                );
            }

            // Create container for React component
            const container = document.createElement('div');
            container.id = 'fluid-cursor-container';
            container.style.position = 'fixed';
            container.style.top = '0';
            container.style.left = '0';
            container.style.width = '100%';
            container.style.height = '100%';
            container.style.zIndex = '1';
            container.style.pointerEvents = 'none';
            document.body.appendChild(container);
            
            fluidCursorRoot = createRoot(container);
            
            try {
                fluidCursorRoot.render(createElement(TestApp));
            } catch (error) {
                console.error('Error rendering FluidCursor:', error);
                document.getElementById('status').innerHTML = `‚ùå Error: ${error.message}`;
                document.getElementById('status').className = 'status error';
            }

            // Make functions available globally for buttons
            window.testMouseMovement = function() {
                // Simulate mouse movement
                const canvas = document.querySelector('#fluid');
                if (canvas) {
                    const rect = canvas.getBoundingClientRect();
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    
                    // Create a circular mouse movement
                    let angle = 0;
                    const radius = 100;
                    
                    function simulateMove() {
                        const x = centerX + Math.cos(angle) * radius;
                        const y = centerY + Math.sin(angle) * radius;
                        
                        const event = new MouseEvent('mousemove', {
                            clientX: x,
                            clientY: y,
                            bubbles: true
                        });
                        
                        window.dispatchEvent(event);
                        angle += 0.1;
                        
                        if (angle < Math.PI * 4) {
                            requestAnimationFrame(simulateMove);
                        }
                    }
                    
                    simulateMove();
                    document.getElementById('status').innerHTML += '<br>üîÑ Simulating mouse movement...';
                } else {
                    document.getElementById('status').innerHTML += '<br>‚ö†Ô∏è Canvas not found';
                }
            };

            window.testClick = function() {
                // Simulate click at center
                const canvas = document.querySelector('#fluid');
                if (canvas) {
                    const rect = canvas.getBoundingClientRect();
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    
                    const event = new MouseEvent('mousedown', {
                        clientX: centerX,
                        clientY: centerY,
                        bubbles: true
                    });
                    
                    window.dispatchEvent(event);
                    document.getElementById('status').innerHTML += '<br>üí• Click splash triggered!';
                } else {
                    document.getElementById('status').innerHTML += '<br>‚ö†Ô∏è Canvas not found for click test';
                }
            };

            window.toggleComponent = function() {
                componentActive = !componentActive;
                if (componentActive) {
                    fluidCursorRoot.render(createElement(TestApp));
                    document.getElementById('status').innerHTML += '<br>‚úÖ Component enabled';
                } else {
                    fluidCursorRoot.render(createElement('div'));
                    document.getElementById('status').innerHTML += '<br>‚è∏Ô∏è Component disabled';
                }
            };

        }).catch(error => {
            console.error('Failed to load FluidCursor component:', error);
            document.getElementById('status').innerHTML = `‚ùå Failed to load component: ${error.message}`;
            document.getElementById('status').className = 'status error';
        });

        // Check for WebGL support
        function checkWebGL() {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');
            
            if (!gl) {
                document.getElementById('status').innerHTML = '‚ùå WebGL not supported - FluidCursor requires WebGL';
                document.getElementById('status').className = 'status error';
                return false;
            }
            
            return true;
        }

        // Initial WebGL check
        if (!checkWebGL()) {
            console.error('WebGL not supported');
        }

        // Monitor for canvas creation
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.tagName === 'CANVAS' && node.id === 'fluid') {
                        console.log('‚úÖ FluidCursor canvas detected!');
                        document.getElementById('status').innerHTML += '<br>üé® Fluid canvas created successfully!';
                        
                        // Monitor canvas for WebGL context
                        setTimeout(() => {
                            const gl = node.getContext('webgl2') || node.getContext('webgl');
                            if (gl) {
                                document.getElementById('status').innerHTML += '<br>üî• WebGL context active!';
                            } else {
                                document.getElementById('status').innerHTML += '<br>‚ö†Ô∏è No WebGL context found';
                            }
                        }, 100);
                    }
                });
            });
        });

        observer.observe(document.body, { childList: true, subtree: true });
    </script>
</body>
</html>